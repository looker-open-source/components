{"version":3,"file":"useQueryIdFromDashboard.js","names":["useEffect","useSWR","getErrorResponse","DataState","useSDK","useQueryIdFromDashboard","dashboardId","sdk","getIdFromDashboard","setByDashboardId","useContainer","queryId","fetcher","dashboard","String","undefined","data","SWRData","isValidating","revalidateOnFocus","_SWRData$value","firstTile","ok","value","dashboard_elements","query","_ref","id","_objectWithoutProperties","_excluded","metadata","_objectSpread","isOK","isPending"],"sources":["../../../src/hooks/useQueryIdFromDashboard.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport { useEffect } from 'react';\nimport type { IDashboard, IError, IQuery } from '@looker/sdk';\nimport type { SDKResponse } from '@looker/sdk-rtl';\nimport useSWR from 'swr';\nimport { getErrorResponse } from '../utils';\nimport { DataState } from './useDataState';\nimport { useSDK } from './useSDK';\n\n/**\n * This hook fetches data from provided dashboard Id, and returns\n * the first query listed in `dashboard_elements` response.\n *\n * @param dashboardId a dashboard Id\n * @returns the query ID associated with the first dashboard tile, and api state\n */\n\nexport const useQueryIdFromDashboard = (dashboardId?: string) => {\n  const sdk = useSDK();\n  const { getIdFromDashboard, setByDashboardId } = DataState.useContainer();\n\n  /*\n   * Check for stored value\n   * -----------------------------------------------------------\n   */\n\n  const queryId = getIdFromDashboard(dashboardId);\n\n  /*\n   * Dispatch network request\n   * -----------------------------------------------------------\n   */\n\n  const fetcher = async () => {\n    if (dashboardId && !queryId) {\n      return await sdk.dashboard(String(dashboardId), 'dashboard_elements');\n    }\n\n    return undefined;\n  };\n\n  const { data: SWRData, isValidating } = useSWR<void | SDKResponse<\n    IDashboard,\n    IError\n  >>(\n    `useQueryIdFromDashboard-${dashboardId}`, // caution: argument string must be unique to this instance\n    fetcher,\n    { revalidateOnFocus: false }\n  );\n\n  /*\n   * Publish SWR response to central data store\n   * -----------------------------------------------------------\n   */\n\n  useEffect(() => {\n    const firstTile = SWRData?.ok\n      ? SWRData?.value?.dashboard_elements?.[0]?.query\n      : undefined;\n\n    const { id, ...query } = firstTile || ({} as IQuery);\n\n    if (dashboardId && id && id !== queryId) {\n      setByDashboardId(dashboardId, id, { metadata: query });\n    }\n  }, [SWRData, dashboardId, setByDashboardId, queryId]);\n\n  return {\n    isOK: !!queryId || typeof dashboardId === 'undefined',\n    isPending: isValidating,\n    queryId,\n    ...getErrorResponse(SWRData),\n  };\n};\n"],"mappings":";;;;;;;;AAKA,SAASA,SAAS,QAAQ,OAAO;AAGjC,OAAOC,MAAM,MAAM,KAAK;AACxB,SAASC,gBAAgB,QAAQ,UAAU;AAC3C,SAASC,SAAS,QAAQ,gBAAgB;AAC1C,SAASC,MAAM,QAAQ,UAAU;AAUjC,OAAO,MAAMC,uBAAuB,GAAIC,WAAoB,IAAK;EAC/D,MAAMC,GAAG,GAAGH,MAAM,CAAC,CAAC;EACpB,MAAM;IAAEI,kBAAkB;IAAEC;EAAiB,CAAC,GAAGN,SAAS,CAACO,YAAY,CAAC,CAAC;EAOzE,MAAMC,OAAO,GAAGH,kBAAkB,CAACF,WAAW,CAAC;EAO/C,MAAMM,OAAO,GAAG,MAAAA,CAAA,KAAY;IAC1B,IAAIN,WAAW,IAAI,CAACK,OAAO,EAAE;MAC3B,OAAO,MAAMJ,GAAG,CAACM,SAAS,CAACC,MAAM,CAACR,WAAW,CAAC,EAAE,oBAAoB,CAAC;IACvE;IAEA,OAAOS,SAAS;EAClB,CAAC;EAED,MAAM;IAAEC,IAAI,EAAEC,OAAO;IAAEC;EAAa,CAAC,GAAGjB,MAAM,CAI5C,2BAA2BK,WAAW,EAAE,EACxCM,OAAO,EACP;IAAEO,iBAAiB,EAAE;EAAM,CAC7B,CAAC;EAODnB,SAAS,CAAC,MAAM;IAAA,IAAAoB,cAAA;IACd,MAAMC,SAAS,GAAGJ,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEK,EAAE,GACzBL,OAAO,aAAPA,OAAO,gBAAAG,cAAA,GAAPH,OAAO,CAAEM,KAAK,cAAAH,cAAA,gBAAAA,cAAA,GAAdA,cAAA,CAAgBI,kBAAkB,cAAAJ,cAAA,gBAAAA,cAAA,GAAlCA,cAAA,CAAqC,CAAC,CAAC,cAAAA,cAAA,uBAAvCA,cAAA,CAAyCK,KAAK,GAC9CV,SAAS;IAEb,MAAAW,IAAA,GAAyBL,SAAS,IAAK,CAAC,CAAY;MAA9C;QAAEM;MAAa,CAAC,GAAAD,IAAA;MAAPD,KAAK,GAAAG,wBAAA,CAAAF,IAAA,EAAAG,SAAA;IAEpB,IAAIvB,WAAW,IAAIqB,EAAE,IAAIA,EAAE,KAAKhB,OAAO,EAAE;MACvCF,gBAAgB,CAACH,WAAW,EAAEqB,EAAE,EAAE;QAAEG,QAAQ,EAAEL;MAAM,CAAC,CAAC;IACxD;EACF,CAAC,EAAE,CAACR,OAAO,EAAEX,WAAW,EAAEG,gBAAgB,EAAEE,OAAO,CAAC,CAAC;EAErD,OAAAoB,aAAA;IACEC,IAAI,EAAE,CAAC,CAACrB,OAAO,IAAI,OAAOL,WAAW,KAAK,WAAW;IACrD2B,SAAS,EAAEf,YAAY;IACvBP;EAAO,GACJT,gBAAgB,CAACe,OAAO,CAAC;AAEhC,CAAC","ignoreList":[]}