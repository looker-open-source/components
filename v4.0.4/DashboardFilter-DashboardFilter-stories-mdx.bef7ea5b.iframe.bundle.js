(globalThis.webpackChunk_looker_storybook=globalThis.webpackChunk_looker_storybook||[]).push([[2127],{"../../node_modules/lodash/compact.js":module=>{module.exports=function compact(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result}},"../filter-components/src/DashboardFilter/DashboardFilter.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>DashboardFilter});var esm_extends=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/extends.js"),react=(__webpack_require__("../../node_modules/core-js/modules/esnext.async-iterator.filter.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("../../node_modules/react/index.js")),src=__webpack_require__("../components/src/index.ts"),Status=__webpack_require__("../components/src/Status/Status.tsx"),Filter=__webpack_require__("../filter-components/src/Filter/Filter.tsx"),use_validation_message=__webpack_require__("../filter-components/src/Filter/utils/use_validation_message.ts"),use_suggestable=__webpack_require__("../filter-components/src/DashboardFilter/use_suggestable.ts"),useControlWarn=__webpack_require__("../components/src/utils/useControlWarn.ts"),FilterCollection=__webpack_require__("../filter-components/src/FilterCollection/FilterCollection.tsx");const DashboardFilter=({filter,sdk,...rest})=>{const{id,name,type,field,required,ui_config,allow_multiple_values}=filter,{removeFilter}=(0,react.useContext)(FilterCollection.f);(0,react.useEffect)((()=>()=>{removeFilter(filter)}),[removeFilter,filter]);const stateProps=(({expression:propsExpression,filter,onChange})=>{const{updateExpression}=(0,react.useContext)(FilterCollection.f),isControlled=(0,useControlWarn.i)({controllingProps:["expression"],isControlledCheck:()=>void 0!==propsExpression,name:"DashboardFilter"}),[uncontrolledExpression,setExpression]=(0,react.useState)(propsExpression||filter.default_value||""),expression=isControlled?propsExpression||"":uncontrolledExpression;return(0,react.useEffect)((()=>{updateExpression(filter,expression)}),[filter,expression,updateExpression]),{expression,onChange:value=>{setExpression(value.expression),onChange(value.expression)}}})({filter,...rest}),{errorMessage,suggestableProps}=(0,use_suggestable.d)({filter,sdk}),validationMessage=(0,use_validation_message.O)(stateProps.expression,required);return react.createElement(src.Field,{id:id||"",label:name||"",detail:errorMessage&&react.createElement(src.Tooltip,{content:errorMessage},react.createElement(Status.q,{intent:"critical","data-testid":"error-icon"})),validationMessage},react.createElement(Filter.w,(0,esm_extends.Z)({name:name||"",type:type||"",field,config:ui_config,isRequired:required},suggestableProps,stateProps,{allowMultipleValues:!!allow_multiple_values})))};try{DashboardFilter.displayName="DashboardFilter",DashboardFilter.__docgenInfo={description:"Renders a dashboard filter, including label and validation, and fetches suggestions\nif necessary. For rendering just the filter input control on its own, see `Filter`.",displayName:"DashboardFilter",props:{expression:{defaultValue:null,description:"The current value of the filter.\nSee {@link https://docs.looker.com/reference/filter-expressions Looker Filter Expressions}.",name:"expression",required:!1,type:{name:"string"}},filter:{defaultValue:null,description:"A dashboard filter as defined in @looker/sdk",name:"filter",required:!0,type:{name:"IDashboardFilter"}},onChange:{defaultValue:null,description:"Called when the filter expression is changed",name:"onChange",required:!0,type:{name:"(expression: string) => void"}},sdk:{defaultValue:null,description:"An initialized Looker SDK instance",name:"sdk",required:!1,type:{name:"IAPIMethods"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../filter-components/src/DashboardFilter/DashboardFilter.tsx#DashboardFilter"]={docgenInfo:DashboardFilter.__docgenInfo,name:"DashboardFilter",path:"../filter-components/src/DashboardFilter/DashboardFilter.tsx#DashboardFilter"})}catch(__react_docgen_typescript_loader_error){}},"../filter-components/src/DashboardFilter/use_suggestable.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{d:()=>useSuggestable});__webpack_require__("../../node_modules/core-js/modules/esnext.async-iterator.reduce.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.reduce.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.async-iterator.filter.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.filter.js");var _looker_sdk__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../filter-components/node_modules/@looker/sdk/lib/esm/4.0/funcs.js"),react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/react/index.js"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../filter-components/src/utils/useTranslation.ts"),_FilterCollection__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../filter-components/src/FilterCollection/FilterCollection.tsx");const shouldFetchSuggestions=field=>field?.suggestable&&!field?.enumerations&&!field?.suggestions,getOptionsProps=(field,fetchedSuggestions)=>{if(shouldFetchSuggestions(field))return{suggestions:fetchedSuggestions};const{enumerations,suggestions}=field||{};return enumerations?{enumerations}:suggestions?{suggestions}:{}},useSuggestable=({filter,sdk})=>{const{state}=(0,react__WEBPACK_IMPORTED_MODULE_5__.useContext)(_FilterCollection__WEBPACK_IMPORTED_MODULE_6__.f),filterMap=state.filterMap,field=filter.field,[searchTerm,setSearchTerm]=(0,react__WEBPACK_IMPORTED_MODULE_5__.useState)(""),[errorMessage,setErrorMessage]=(0,react__WEBPACK_IMPORTED_MODULE_5__.useState)(""),[isLoading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_5__.useState)(!1),[fetchedSuggestions,setSuggestions]=(0,react__WEBPACK_IMPORTED_MODULE_5__.useState)([]),{t}=(0,_utils__WEBPACK_IMPORTED_MODULE_7__.$)("use_suggestable"),translatedErrorMessage=t("Error loading suggestions"),{listens_to_filters}=filter,linkedFilterMap=(0,react__WEBPACK_IMPORTED_MODULE_5__.useMemo)((()=>((filterMap,listensToFilters)=>{if(listensToFilters&&0!==listensToFilters.length)return listensToFilters.reduce(((acc,title)=>{if(filterMap[title]){const{filter,expression}=filterMap[title];filter.dimension&&expression&&(acc[filter.dimension]=expression)}return acc}),{})})(filterMap,listens_to_filters)),[filterMap,listens_to_filters]);return(0,react__WEBPACK_IMPORTED_MODULE_5__.useEffect)((()=>{(async()=>{if(sdk&&shouldFetchSuggestions(field)){setLoading(!0);const params={field_name:field?.suggest_dimension||"",model_name:filter.model||"",term:searchTerm,view_name:field?.suggest_explore||field?.view||"",filters:linkedFilterMap};try{const result=await sdk.ok((0,_looker_sdk__WEBPACK_IMPORTED_MODULE_8__.qoF)(sdk,params));setLoading(!1),setSuggestions(result.suggestions||[])}catch(error){setLoading(!1),setErrorMessage(translatedErrorMessage)}}})()}),[filter.model,field,searchTerm,sdk,linkedFilterMap,translatedErrorMessage]),{errorMessage,suggestableProps:{isLoading,onInputChange:setSearchTerm,...getOptionsProps(field,fetchedSuggestions)}}}},"../filter-components/src/FilterCollection/FilterCollection.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{f:()=>FilterContext});__webpack_require__("../../node_modules/core-js/modules/esnext.async-iterator.filter.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("../../node_modules/core-js/modules/esnext.iterator.filter.js");var react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/react/index.js");const getFilterMap=(filterMap,payload)=>{const{filter,expression}=payload;if(expression){const newKeyValue=filter.title?{[filter.title]:payload}:{};return{...filterMap,...newKeyValue}}if(filter.title){const{[filter.title]:filterToRemove,...rest}=filterMap;return rest}return filterMap},reducer=(state,action)=>{switch(action.type){case"UPDATE_EXPRESSION":case"REMOVE_FILTER":return{...state,filterMap:getFilterMap(state.filterMap,action.payload)};default:throw new Error}},noop=()=>{},initialState={filterMap:{}},initialContext={removeFilter:noop,state:initialState,updateExpression:noop},FilterContext=(0,react__WEBPACK_IMPORTED_MODULE_3__.createContext)(initialContext),FilterCollection=({children})=>{const[state,dispatch]=useReducer(reducer,initialState),updateExpression=useCallback(((filter,expression)=>{dispatch({type:"UPDATE_EXPRESSION",payload:{filter,expression}})}),[]),removeFilter=useCallback((filter=>{dispatch({type:"REMOVE_FILTER",payload:{filter}})}),[]);return React.createElement(FilterContext.Provider,{value:{removeFilter,state,updateExpression}},children)};try{FilterCollection.displayName="FilterCollection",FilterCollection.__docgenInfo={description:"FilterCollection's primary purpose is to manage a filter map\nobject, with filter metadata objects as keys and current\nselected expressions as values.\n\nThis allows filters with `listens_to_filters` to pull the relevant\nexpressions out when performing a linked filter suggestion query.",displayName:"FilterCollection",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../filter-components/src/FilterCollection/FilterCollection.tsx#FilterCollection"]={docgenInfo:FilterCollection.__docgenInfo,name:"FilterCollection",path:"../filter-components/src/FilterCollection/FilterCollection.tsx#FilterCollection"})}catch(__react_docgen_typescript_loader_error){}},"../filter-components/src/DashboardFilter/DashboardFilter.stories.mdx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,__page:()=>__page,default:()=>__WEBPACK_DEFAULT_EXPORT__});__webpack_require__("../../node_modules/react/index.js");var _mdx_js_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/@mdx-js/react/dist/esm.js"),_looker_filter_components__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__("../../node_modules/@storybook/addon-docs/dist/esm/index.js"),__webpack_require__("../filter-components/src/DashboardFilter/DashboardFilter.tsx"));function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const makeShortcode=name=>function MDXDefaultShortcode(props){return console.warn("Component "+name+" was not imported, exported, or provided by MDXProvider as global scope"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("div",props)},Meta=makeShortcode("Meta"),ImportMessage=makeShortcode("ImportMessage"),layoutProps={};function MDXContent({components,...props}){return(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("wrapper",_extends({},layoutProps,props,{components,mdxType:"MDXLayout"}),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)(Meta,{component:_looker_filter_components__WEBPACK_IMPORTED_MODULE_3__.a,title:"Docs/Components/Filters/DashboardFilter",mdxType:"Meta"}),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("h1",{id:"dashboardfilter"},"DashboardFilter"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)(ImportMessage,{packageName:"filter-components",mdxType:"ImportMessage"},"DashboardFilter"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("p",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("inlineCode",{parentName:"p"},"DashboardFilter")," renders a dashboard filter as returned by the Looker API."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("p",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("strong",{parentName:"p"},"Note:")," for more direct rendering control, see the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("a",{parentName:"p",href:"filter"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("inlineCode",{parentName:"a"},"Filter"))," component."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("code",{parentName:"pre",className:"language-jsx"},"<DashboardFilter\n  filter={{\n    field: { is_numeric: true },\n    id: 1,\n    name: 'Age',\n    type: 'field_filter',\n  }}\n/>\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("h2",{id:"expression--onchange"},"expression & onChange"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("p",null,"Use ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("inlineCode",{parentName:"p"},"onChange")," to get updates to the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("inlineCode",{parentName:"p"},"expression"),"."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)("code",{parentName:"pre",className:"language-jsx"},";() => {\n  const [expression, setExpression] = useState('[0,100]')\n  return (\n    <SpaceVertical>\n      <DashboardFilter\n        filter={{\n          field: { is_numeric: true },\n          id: 1,\n          name: 'Age',\n          type: 'field_filter',\n        }}\n        expression={expression}\n        onChange={setExpression}\n      />\n      <Paragraph>\n        <strong>Current filter expression:</strong> {expression}\n      </Paragraph>\n    </SpaceVertical>\n  )\n}\n")))}MDXContent.displayName="MDXContent",MDXContent.isMDXComponent=!0;const __page=()=>{throw new Error("Docs-only story")};__page.parameters={docsOnly:!0};const componentMeta={title:"Docs/Components/Filters/DashboardFilter",component:_looker_filter_components__WEBPACK_IMPORTED_MODULE_3__.a,includeStories:["__page"]};componentMeta.parameters=componentMeta.parameters||{},componentMeta.parameters.docs={...componentMeta.parameters.docs||{},page:()=>(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.kt)(MDXContent,null)};const __WEBPACK_DEFAULT_EXPORT__=componentMeta,__namedExportsOrder=["__page"]}}]);